---
title: "run_admixture.Rmd"
author: "SDS"
date: "Last compiled on `r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    df_print: kable
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(
  root.dir =
    "/Users/slacksa/OneDrive - The University of Colorado Denver/Immunogenetics_T1D")

library(tidyverse)
library(conflicted)

```

# **Overview**

RMarkdown runs Admixture using 1000G as reference. This report is not intended
to be knit - just to be run chunk by chunk.ÃŸ

Requires PLINK1.9, PLINK2, bcftools, and ADMIXTURE.


# **Run Admixture**

### Steps 0-1 & 0-2

Skipping scripts 0-1 and 0-2 - already run by Shane in ancestry_estimation.qmd.

### Step 1-1

```{zsh engine.opts='-i', eval = F}
mamba activate bcftools
code_dir="/Users/slacksa/repos/tools/admixture"
RKJCOLLAB="/Users/slacksa/Library/CloudStorage/OneDrive-TheUniversityofColoradoDenver"

bash "$code_dir"/1-1_get_comm_variants.sh \
  -r ${RKJCOLLAB}/Immunogenetics_T1D/genetics/teddy_r01/1000genomesPCA/qc/1000G.chr1.qc.pruned \
  -s ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/daisyask_exome_array/clean/daisyexome_study_ids \
  -o ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/admixture

```

Note: multi-allelic warning at first merge (by-chr merge of reference) -
for now, just removing these variants but could revisit in future.

17827 overlapping variants for Admixture.


### Step 1-2

```{zsh engine.opts='-i', eval = F}
mamba activate bcftools
code_dir="/Users/slacksa/repos/tools/admixture"
RKJCOLLAB="/Users/slacksa/Library/CloudStorage/OneDrive-TheUniversityofColoradoDenver"

bash "$code_dir"/1-2_merge.sh \
  -o ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/admixture

```


17824 variants for admixture after flipping and excluding variants that coulnd't
be flipped.

### Step 1-3

```{zsh engine.opts='-i', eval = F}
mamba activate bcftools
code_dir="/Users/slacksa/repos/tools/admixture"
RKJCOLLAB="/Users/slacksa/Library/CloudStorage/OneDrive-TheUniversityofColoradoDenver"

bash "$code_dir"/1-3_prune.sh \
  -o ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/admixture

```

16489 variants after pruning.

### Step 2-1

This step is slow and may be skipped if already done for reference population.
Use the K selected by CV in step 2-2.

SDS testing: K=1: 0.68715, K=2: 0.64285

```{zsh engine.opts='-i', eval = F}
mamba activate bcftools
code_dir="/Users/slacksa/repos/tools/admixture"
RKJCOLLAB="/Users/slacksa/Library/CloudStorage/OneDrive-TheUniversityofColoradoDenver"

bash "$code_dir"/2-1_admixture_cv.sh \
  -o ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/admixture

```


### Step 2-2


```{zsh engine.opts='-i', eval = F}
mamba activate bcftools
code_dir="/Users/slacksa/repos/tools/admixture"
RKJCOLLAB="/Users/slacksa/Library/CloudStorage/OneDrive-TheUniversityofColoradoDenver"

bash "$code_dir"/2-2_admixture.sh \
  -o ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/admixture \
  -k 5

```

# **Session Info**

R Session info:

```{r session_info}
sessionInfo()
```
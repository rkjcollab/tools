---
title: "run_genesis.Rmd"
author: "SDS"
date: "Last compiled on `r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    df_print: kable
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(
  root.dir =
    "/Users/slacksa/OneDrive - The University of Colorado Denver")

library(tidyverse)
library(conflicted)
library(data.table)

```

# **Overview**

RMarkdown runs GENESIS, to be run after the Admixture pipeline. This report is
not intended to be knit - just to be run chunk by chunk.

Requires PLINK1.9, PLINK2, GENESIS (in R), SNPRelate (in R), KING.


# **Run GENESIS**

### Step 1

*TODO: for DAISY, just using exome chip QCed by UVA - do we need to update to*
*Shane's pipeline?*

*TODO: adding second list filtering option to subset to EUR and DAISY only here,*
*revisit and find a better way!*

```{zsh engine.opts='-i', eval = F}
mamba activate bcftools
code_dir="/Users/slacksa/repos/tools/genesis"
RKJCOLLAB="/Users/slacksa/Library/CloudStorage/OneDrive-TheUniversityofColoradoDenver"

bash "$code_dir"/1_subset_make_gds.sh \
  -s ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/daisyask_exome_array/clean/daisyexome_study_ids \
  -e ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/admixture/ancestry_estimation/study_eur_list.txt \
  -i ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/final_plink_report_BDC/daisy_study_id_list.txt \
  -o ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/genesis

```

Only have 366 of the 447 people in DAISY after EUR filter.

### Step 2

```{zsh engine.opts='-i', eval = F}
code_dir="/Users/slacksa/repos/tools/genesis"
RKJCOLLAB="/Users/slacksa/Library/CloudStorage/OneDrive-TheUniversityofColoradoDenver"

bash "$code_dir"/2_king_pcair.sh \
  -s ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/genesis/study_nhw \
  -p ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/genesis/study_nhw_pruned \
  -l ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/genesis/study_nhw_prune.in

```

299 unrelated, 67 related.

Look at PC scree plot - think 2 PCs, although variance explained is VERY small.

### Step 3

```{zsh engine.opts='-i', eval = F}
code_dir="/Users/slacksa/repos/tools/genesis"
RKJCOLLAB="/Users/slacksa/Library/CloudStorage/OneDrive-TheUniversityofColoradoDenver"

bash "$code_dir"/3_pcrelate_grm.sh \
  -s ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/genesis/study_nhw \
  -l ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/genesis/study_nhw_prune.in \
  -n 2

```



# **Session Info**

R Session info:

```{r session_info}
sessionInfo()
```
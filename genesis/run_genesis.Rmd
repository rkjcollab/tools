---
title: "run_genesis.Rmd"
author: "SDS"
date: "Last compiled on `r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    df_print: kable
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(
  root.dir =
    "/Users/slacksa/OneDrive - The University of Colorado Denver")

library(tidyverse)
library(conflicted)
library(data.table)

```

# **Overview**

This RMarkdown runs GENESIS, to be run after the Admixture pipeline. This report
is not intended to be knit - just to be run chunk by chunk.

Requires PLINK1.9, PLINK2, GENESIS (in R), SNPRelate (in R), KING.

# **Run GENESIS**

### Step 1


```{zsh engine.opts='-i', eval = F}
mamba activate bcftools
code_dir="/Users/slacksa/repos/tools/genesis"

bash "$code_dir"/1_subset_make_pruned_gds.sh \
  -s ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/tm_r3_imp/full_qc/pre_qc/pre_qc \
  -e ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/admixture/ancestry_estimation/study_eur_list.txt \
  -o ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/genesis

```

XX variants and XX people after step 1.

### Step 2

```{zsh engine.opts='-i', eval = F}
code_dir="/Users/slacksa/repos/tools/genesis"

bash "$code_dir"/2_king_pcair.sh \
  -s ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/genesis/study_nhw \
  -p ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/genesis/study_nhw_pruned \
  -l ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/genesis/study_nhw_prune.in

```

XX completely unrelated (XX related), but XX considered unrelated after
kinship threshold 0.0220970869120796 applied (GENESIS default, slightly stricter
than third-degree relatives (first cousins)).

Look at PC scree plot - think XX PCs based on plot elbow.

### Step 3

```{zsh engine.opts='-i', eval = F}
code_dir="/Users/slacksa/repos/tools/genesis"

bash "$code_dir"/3_pcrelate_grm.sh \
  -s ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/genesis/study_nhw \
  -l ${RKJCOLLAB}/DAISY/genetics/daisy_ask_genetics/genesis/study_nhw_prune.in \
  -n 2

```

Run with XX PCs, XX samples without relatives, and no negative eigenvalues in
the final GRM.

# **Session Info**

R Session info:

```{r session_info}
sessionInfo()
```